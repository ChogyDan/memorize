<!--#Area to enter the text
. the area should have divisors that break up the text
. 2 kinds of divisers
.. one which connects sections to each other in an ordered way
.. another which disconnects sections, in other words, indicates a section is unordered

#operators for fast dividing the text
. ie, convert all newlines / double newlines / commas / whatever into divisers for the text


# an area to the side for an outline of a text
. drag and drop between the two texts to connect them
-->
<!--Intermediate goals, input a basic text
-text box for viewing the text
-selector for selecting currently saved texts
-some buttons for saving or deleting
-->
<html>                                                                  
 <head> 
 <meta http-equiv="content-type" content="text/html;charset=utf-8" />
 <link rel="stylesheet" type="text/css" href="memorize_all.css" />
  <link rel="stylesheet" type="text/css" href="texts.css" />
 <script type="text/javascript" src="jquery.js"></script>
 <script type="text/javascript" src="underscore.js"></script>
  <script type="text/javascript" src="helpercode.js"></script>
 <script type="text/javascript">
  $(document).ready(function() {
    //setup
  var textNames = pullArrayFromLS('textNames'); 
    var textFolderTexts = pullArrayFromLS('textFolderTexts'); 
    var flagNewTextCurrentlyBeingEdited = true;
    var newTextSave = "";
    resetToNewText();
    
    function addTextToPage(usTextName) {
      $("select").append("<option>"+usTextName+"</option>");
    }
    function resetToNewText () {
      $("#input").val(newTextSave);
      flagNewTextCurrentlyBeingEdited = true;
      $("select").val("(new text)");
      $("#input").keyup();
    }
    function save () {
    pushArrayToLS(textNames, 'textNames');
    pushArrayToLS(textFolderTexts, 'textFolderTexts');
    }

    function getSelectedTitle() {
      return $("select").val();
    }

    function getSelectedText() {
      return textFolderTexts[_.indexOf(textNames, getSelectedTitle())];
    }

    $("#input").on('keyup', function (e) {
      $(this).css('height', 'auto');
      $(this).height( this.scrollHeight );
      console.log( this.scrollWidth );
    });
    $("#input").keyup();

    $("#save").click(function () {
      while(true){//todo: This while loop gets a name.  Change this to something cool.
        var newTextName=prompt("Please enter a name for this text.");
        if(newTextName!=null && newTextName!='' && _.indexOf(textNames, newTextName)==-1) {
          textFolderTexts.push($("#input").val());
          textNames.push(newTextName);
          save();
          addTextToPage(newTextName);
          $("select").val(newTextName);
          flagNewTextCurrentlyBeingEdited = false;
          newTextSave = "";
          break;
        }
      }

    })

    //setup the <select> with the currently saved texts
    _.each(textNames, function(name, index, textFolder) {
      addTextToPage(name);
    });

    $("select").change(function() {
      titleOfTextToSwitchTo = $(this).val();
      if(flagNewTextCurrentlyBeingEdited == true) newTextSave = $("#input").val();
      if(titleOfTextToSwitchTo != "(new text)") {
        $("#input").val(textFolderTexts[_.indexOf(textNames, titleOfTextToSwitchTo)]);
        flagNewTextCurrentlyBeingEdited = false;
      } else resetToNewText();
      $("#input").keyup();
    });
  
    $("#delete").click(function () {
      titleToDelete = getSelectedTitle();
      indexToDelete = _.indexOf(textNames, titleToDelete);
      textFolderTexts.splice(indexToDelete, 1);
      textNames.splice(indexToDelete, 1);
      $("option:selected").remove();
      save();
      resetToNewText();
    });

    $("#memorize").click(function () {
      if(getSelectedTitle() == "(new text)") {
        alert("Please select a text");
        return;
      }
      if ($("#test_selector input:checked").val() == undefined) {
        alert("Please select a type for the text");
        return;
      }

      var newMemorization = new InstanceOfMemorization( getSelectedTitle(), 
                                                        getSelectedText().split('\n'),
                                                        $("#test_selector input:checked").val(),
                                                        true );
      localStorage.setItem('current', newMemorization.index);
      window.location.href = 'memorize.html';
    });
 });                                    
 </script>                                                               
 </head>                                                                
  <body> 


   
    <div id="controls" class="right">
      <div id="test_selector">
        <input type="radio" name="structure" value="poem" />Poem
        <input type="radio" name="structure" value="vocab" />Vocab List
      </div>
      <select>
        <option>(new text)</option>
      </select> <br />
      <a id="save" class="basics">Save</a><a id="delete" class="delete_button basics">Delete</a> <br />
      <a id="memorize" class="basics right_arrow">Begin memorizing!</a>
    </div>
     <div class="left"><textarea id="input"></textarea></div>
    
  </body>
</html>